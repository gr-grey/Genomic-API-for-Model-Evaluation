---
---
---

### API Specifications


### Communication protocol

### Evaluator request message

| Key                 | Value type - Required/Optional                   | Description: Value options  | Example                                                                                                                                                                                                 |
|--------------|--------------|-------------------------------|--------------|
| `request`              | `string` - Required                 | Requested task for Predictor : ["predict", "help"].                                                                                                                                                                                                                                                                         | "request": "predict"                                                                                                                                                                                       |
| `readout`           | `string` - Required                | Type of readout that is requested from the Predictor: ["point","track", "interaction_matrix"].                                                                                                                                                                                                                                                                              | "readout": "track"                                                                                                                                                                                      |
| `prediction_task`  | `array of objects` - Required        | Each object must contain the following keys: `name`, `type`, `cell_type`, `species`, `scale`(optional).                                                                                                                                                                                          | "prediction_task": [<br> {<br>   "name": "task1",<br>   "type": "expression",<br>  "cell_type": "iPSC",<br>  "scale": "linear",<br>  "species": "homo_sapiens" <br> }<br>]                                                                                                                                          |
| `name`  | `string` - Required        | Unique identifier for each prediction task object.                                                                                                                                                                                          | "name": "model_prediction"                                                                                                                                          |
| `type`  | `string` - Required        | Prediction type you want predicted. "binding_<molecule>" can be for any type of binding assay (ex. CHIP-Seq, H3k27ac) and the text trailing the "_" is not case sensitive  : ["accessibility", "binding_molecule" , expression", "chromatin_confirmation"]. `expression` by default refers to mRNA production ["expression_mRNA] ex. RNA-seq. The other valid types are ["expression_pol1", "expression_pol2", "expression_pol3"].                                                                                                                                                                                          | "type": "expression"                                                                                                                                         |
| `cell_type`        | `string` - Required       | What cell type you want predicted for `type`.                                                                                                                                                                                | "cell_type": "K562"                                                                                                                                                            |
| `species`        | `string` - Required       | What species you want predicted for `type`.                                                                                                                                                                              | "species": "homo_sapiens"                                                                                                                                                                |
| `scale`             | `string` - Optional                 | How would you like the predictions scaled upon return (if at all): ["linear", "log"].                                                                                                                                                                                                                                                                         | "scale" : "linear"                                                                                                                                                                                         |
| `upstream_seq`      | `string`- Optional                  | Upstream flanking sequences to add to each sequence in `sequences`.                                                                                                                                                                                                                                                                                       | "upstream_seq": "AATTA"                                                                                                                                                                                |
| `downstream_seq`    | `string`- Optional                  | Downstream flanking sequences to add to each sequence in `sequences`.                                                                                                                                                                                                                                                                                    | "downstream_seq": "CCCAAAA"                                                                                                                                                                            |
| `sequences`         | `object` - Required       | A collection of key-value pairs (strings). Keys are unique sequence ID keys - any characters [A-Z][a-z][0-9][-.\_\~#\@%^&\*()]. The sequence ID keys are matched to the Predictor sequence ID keys automatically by Predictor.                                                                                                                             | "sequences": {<br>   "seq1": "ATGC...",<br>   "seq2": "ATGC...",<br>  "random_seq": "ATGC...",<br>  "enhancer": "ATGC...",<br>  "control": "ATGC..." <br> }                                  |
| `prediction_ranges` | `object` - Optional | A collection of key-value pairs, where the keys should be identical to sequence ID keys and values are arrays with the start and end region you want predicted for each sequence. Start and end are 0 indexed and inclusive (e.g. [0,1] is the first two bases).| "prediction_ranges": {<br>   "seq1": [0,1000],<br>   "seq2": [100,110],<br>  "random_seq": [],<br>  "enhancer": [210,500],<br>  "control": [] <br> } |

Notes: <br>
1. keys in `sequences` must be unique or will be overwritten during the reading in <br>
2. all indexing is 0 based <br>
3. to minimize any bias from the predictors we suggested randomizing your sequences so that there is no dependency on the order

### Predictor return message

| Key                 | Value type - Required/Optional                   | Description: Value options  | Example   |
|--------------|--------------|-------------------------------|--------------|
| `request` | `string`- Required           | What request was completed by the model: ["predict", "help"]                                                                                                                                                                         | "task": "predict"      |
| `bin_size` | `integer` - Required for track based models           | Resolution of the model's predictions.                                                                                                                                                    | "bin_size" : 1          |
| `prediction_task`  | `array of objects` - Required        | Each object must contain the following keys: `name`, `type_requested`,`type_actual`, `cell_type_requested`, `cell_type_actual`, `species_requested`, `species_actual`, `scale_prediction_requested` (optional), `scale_prediction_actual` (optional), `aggregation_replicates` (optional).| "prediction_task": [<br> {<br>   "name": "task1",<br>   "type_requested": "expression",<br>  "type_actual": "expression",<br>  "cell_type_requested": "K562",<br>  "cell_type_actual": "bone_marrow_cell_line",<br>  "species_requested": "homo_sapiens",<br>  "species_actual": "homo_sapeins",<br>  "scale_prediction_requested": "linear", <br>  "scale_prediction_actual": "linear",<br>  "aggregation_replicates": "mean",<br>   "predictions": { <br>     "seq1": [12.2, 5, 6, ..],<br>     "seq2": [1.1, 12, 0.00, ..],<br>    "random_seq": [100.1, 50, 0.5, ..],<br>    "enhancer": [4, 3.0, 0.001, ..],<br>    "control": [0, 0, 0, ..] <br>   }<br> }<br>]|
| `name`  | `string` - Required        | Unique identifier for each prediction task array matched from Evaluator.| "name": "task_for_model"|
| `type_requested`  | `string` - Required        | Prediction type requested. "binding_<molecule>" can be for any type of binding assay (ex. CHIP-Seq, H3k27ac) and the text trailing the "_" is not case sensitive: ["accessibility", "binding_molecule" , expression", "chromatin_confirmation"].                                                                                                                                                                                          | "type_requested": "expression"                                                                                                                                         |
| `type_actual`  | `string` - Required        | Prediction type compleated by Predictor.                | "type_actual": "expression"|         
|`cell_type_requested`       | `string`- Required | Cell type requested by Predictor.                                   | "cell_type_requested": ["HEPG2"] |
| `cell_type_actual`       | `string`- Required | Cell type returned by Predictor. Predictor can choose to use cell type/cell line ontology container which will returned the closest matched cell type that the Predictor has.| "cell_type_actual": ["HEPG2"] |
| `species_requested`        | `string` - Required       | What species was requested by the Predictor.  | "species_requested": "homo_sapiens" | 
|`species_actual`        | `string` - Required       | What species was used by the Predictor.                                                                                                                                                                              | "species_actual": "homo_sapiens"|
| `scale_prediction_requested` | `string` - Optional            | Evaluator requested scaling for predictions: ["linear", "log"].                                                                                                                                                    | "scale_prediction_requested": "log"       |
| `scale_prediction_actual` | `string` - Optional            | How did the Predictor scale the predictions (if at all): ["linear", "log"] .                                                                                                                                                   | "scale_prediction_actual": "log"    |
|`aggregation_replicates`      | `string`- Optional           | How replicates were aggregated.                                                                                                                           | "aggregation_replicates": "mean"  |
|`aggregation_bins`      | `string`- Optional           | How bins in track based models were aggregated to produce point predictions.                                                                                                                           | "aggregation_bins": "mean"  |
| `predictions`      | `object`- Required    | Objects of key-value pairs where keys are strings and values are arrays of floats/integers/base64. Each array of predictions can be a single value, a list of values for track predictions or a base64 string that encodes interaction matrices. The sequence ID keys are matched to the Evaluator sequence ID keys automatically by Predictor |"predictions": {<br>   "seq1": [12.2, 5, 6, ..],<br>   "seq2": [1.1, 12, 0.00, ..],<br>  "random_seq": [100.1, 50, 0.5, ..],<br>  "enhancer": [4, 3.0, 0.001, ..],<br>  "control": [0, 0, 0, ..] <br> } |

### Retrive information about Predictor classes

Any Evaluator can retrieve information from a Predictor by asking for `help` in the `task` key. This will return a `.json` file that is written by the Predictor, while these are not mandatory we highly encourage detailed `help` responses to organize and document Predictor containers. 

Message sent by evalutor:

| Key: Value    | Value type- Required/Optional         |Description                                                                 |
|--------------|--------------|---------------------|
| "request": "help" | `string`- Required| Retrieve basis information about the Predictor (written by model developers) |

Message returned by Predictor:

| Key  | Value type     | Description       | Example Values |
|------|---------------|-------------------------------------------|-------------------|
| `model`                 | `string`- Optional  | Model name.                                                                                                         | "model": "deBoer Lab test" |
| `version`               | `string`- Optional  | Information about version of Predictor.                                                                                 | "version": "2.2"|
| `publication`               | `string`- Optional  | Citation for original paper.                                                                                | "publication": "Luthra et. al, 2024"|
| `build_date`            | `string`- Optional  | Date the Predictor container was built - to track potential rebuilds.                                               | "build_date": "Aug 20, 2024"|
| `features`              | `array of strings`- Optional   | List of features that the model predicts for each of the cells in `cell_types`.                                                 | "features": ["accessibility", "accessibility", "binding_H3K4me3","binding_CTCF","expression", "expression", "expression"] |
| `cell_types`              | `array of strings`- Optional   | Cell types that correspond to predicted features in `features`. Length of "cell_types" should be the same as "features" or length 1.                                              | "cell_types": ["iPSC", "Hepg2", "iPSC", "iPSC", "iPSC", "HepG2",  "K562"] |
| `species`               | `array of strings`- Optional  | Species that correspond to predicted features in `features`. Length of "species" should be the same as "features" or length 1.                                               | "species": ["homo_sapiens"]|
| `container_authors`                | `string`- Optional  | Author/authors of container builders.                                                                 |  "container_authors": "Ishika Luthra" |
| `model_authors`                | `string`- Optional  | Paper author/authors.                                                                  |  "model_authors": "Ishika Luthra" |
| `input_size`            | `Integer`- Optional | Number of base pairs of sequence that the model takes as input.                                                  | "input_size" : 500500 |
| `bin_size`            | `Integer`- Optional | For models that predict across genomic tracks what is the base pair resolution.                                     | "bin_size": 10|
| `expression_strand_specific` | `Boolean`- Optional | For models that predict expression, is the expression prediction strand specific or not. | "expression_strand_specific": true|
### Error messages

Error messages that should be returned by the predictors in .json format. Error messages should be returned via one of the 3 possible keys so that the evaluators can "catch" the exception. Values can follow the format described below (any type) or other/additional ones can be added by the Predictor builders.

We encourage Predictor builders to return error messages in the format show below. Helper functions that have some basic error catching to build off can be found in the `src` folder. 

| Error Message Keys    | Value type |Description                                               | Example Values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|-------------|-------------|----------------------------------------------|---------------------|
| `bad_prediction_request`    | `array of strings` |Request was unacceptable - model did not run.          | •.json file is formatted incorrectly. <br> •Mandatory key `x` is missing in .json. <br> •`request` value is not recognized. Model developers can choose what to return here. <br>•Value in `type` is not recognized. Model developers can choose what to return here. <br> •Duplicate sequence ID key in `sequences`: sequence ID key `y` is duplicated. <br> •`prediction_ranges` are required to be integers. <br> •Sequence ids in `prediction_ranges` do not match those in `sequences`. <br> •Length of each sub-array in `prediction_ranges` should not be greater than 2. <br> •Sequence ID key `z` has an invalid character present. <br> |
| `prediction_request_failed` | `array of strings` |Evaluator message was valid -  model prediction was incomplete. | •"seq_z" in `sequences` has an invalid character present. <br> •Model cannot handle sequence lengths this large. <br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `server_error`              | `array of strings` | Backend issue.     | •Socket communication failed. <br> •Wifi error. <br> •Memory error (eg. due to large batch size, due to large .json file).                                                                                                                                                                                                                                                                                                                                                                                                                                                 
